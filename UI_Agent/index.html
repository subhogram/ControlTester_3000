<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Management System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Top Header -->
        <header class="topbar">
            <div class="topbar-title">Risk Control AI</div>
        </header>
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Hamburger shown only when collapsed; centered at top of sidebar -->
            <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="true" title="Expand sidebar">‚ò∞</button>
            <div class="sidebar-header">
                <img src="kpmg.png" alt="KPMG" class="company-logo">
                <div class="api-status" id="api-status">
                    <span class="status-indicator">üî¥</span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-link active" data-tab="document-management">
                    <span class="nav-icon">üìÅ</span>
                    <span class="nav-text">Documents</span>
                </button>
                <button class="nav-link" data-tab="document-assessment">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Assessment</span>
                </button>
                <button class="nav-link" data-tab="document-chat">
                    <span class="nav-icon">üí¨</span>
                    <span class="nav-text">Chat</span>
                </button>
            </nav>

            <!-- Close (collapse) button shown only when expanded -->
            <button id="sidebar-close" class="sidebar-close" aria-label="Collapse sidebar" title="Collapse sidebar">‚úï</button>

            <!-- Sidebar Footer / Utilities -->
            <div class="sidebar-footer">
                <button id="sidebar-utility-btn" class="sidebar-utility-btn" aria-haspopup="true" aria-expanded="false" title="User menu">
                    <img src="user.png" alt="User" class="utility-icon" />
                </button>
                <div id="sidebar-utility-menu" class="sidebar-utility-menu hidden" role="menu" aria-label="Quick actions">
                    <button class="utility-item" id="util-login" role="menuitem">üîê Login</button>
                    <button class="utility-item" id="util-help" role="menuitem">‚ùì Help</button>
                    <button class="utility-item" id="util-settings" role="menuitem">‚öôÔ∏è Settings</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Document Management Tab -->
            <div id="document-management" class="tab-content active">
                <div class="content-header">
                    <h1>Document Management</h1>
                    <p class="content-description">Upload documents and build knowledge bases for AI-powered document
                        retrieval</p>
                </div>

                <!-- Model Configuration -->
                <div class="model-selection-header">
                    <div>
                        <h2>Model Configuration</h2>
                        <p>Select and configure your Ollama model for document processing</p>
                    </div>

                    <div class="model-selector-container">
                        <!-- Initial Model Selector -->
                        <div id="initial-model-selector" class="model-selector">
                            <select id="session-model-select" class="form-control">
                                <option value="">Loading models...</option>
                            </select>
                            <div id="model-validation" class="model-validation" style="display: none;"></div>
                        </div>

                        <!-- Selected Model Display -->
                        <div id="selected-model-display" class="selected-model-display" style="display: none;">
                            <div class="selected-model-info">
                                <div>
                                    <div class="model-label">Selected Model</div>
                                    <div class="model-name" id="selected-model-name">llama2</div>
                                    <div class="model-status">Ready for processing</div>
                                </div>
                            </div>
                            <button id="change-model-btn" class="btn btn--outline change-model-btn">Change
                                Model</button>
                        </div>
                    </div>
                </div>

                <!-- Document Sections -->
                <div class="document-sections">
                    <!-- General Documents -->
                    <div class="document-card">
                        <div class="card-header">
                            <div class="card-title-section">
                                <h3 class="card-title">General Documents</h3>
                                <p class="document-count" id="general-count">No documents uploaded yet</p>
                            </div>
                            <div class="card-status">
                                <span class="status" id="general-status">üìã Ready</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-description">Upload general documents for global knowledge base creation
                                using Faiss vectorstore</p>

                            <!-- Upload Area -->
                            <div class="upload-area" id="general-upload-area">
                                <div class="upload-content">
                                    <div class="upload-icon">üìÅ</div>
                                    <p class="upload-text"><strong>Drag and drop files here</strong></p>
                                    <p class="upload-text">or <button class="upload-link">browse files</button></p>
                                    <p class="upload-info">Supported formats: PDF, TXT, DOCX, MD (Max 10MB each)</p>
                                </div>
                            </div>

                            <!-- Document List -->
                            <div id="general-docs-container" class="document-list">
                                <p class="no-docs">No documents uploaded yet</p>
                            </div>

                            <div class="doc-list-actions">
                                <button id="general-clear-files" class="btn btn--outline btn--sm" style="display:none;">
                                    Clear All Files
                                </button>
                            </div>


                            <!-- Build Section -->
                            <div class="build-section">
                                <button class="btn btn--primary btn--full-width build-btn" id="general-build-btn"
                                    disabled>
                                    üèóÔ∏è Build & Save Knowledge Base
                                </button>
                                <p id="general-build-hint" class="build-hint">Select a model above to enable building
                                </p>
                            </div>

                            <!-- Status Display -->
                            <div class="status-display">
                                <div class="status-item">
                                    <span class="status-label">Knowledge Base Status:</span>
                                    <span class="status-value" id="general-kb-status">No model selected</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Vector Count:</span>
                                    <span class="status-value" id="general-vector-count">0</span>
                                </div>
                                <div class="status-item saved-path-item" id="general-save-path-item"
                                    style="display: none;">
                                    <span class="status-label">Saved Path:</span>
                                    <span class="status-value saved-path" id="general-save-path"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Company Documents -->
                    <div class="document-card">
                        <div class="card-header">
                            <div class="card-title-section">
                                <h3 class="card-title">Company Documents</h3>
                                <p class="document-count" id="company-count">No documents uploaded yet</p>
                            </div>
                            <div class="card-status">
                                <span class="status" id="company-status">üìã Ready</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-description">Upload company-specific documents for company knowledge base
                                creation and storage</p>

                            <!-- Upload Area -->
                            <div class="upload-area" id="company-upload-area">
                                <div class="upload-content">
                                    <div class="upload-icon">üè¢</div>
                                    <p class="upload-text"><strong>Drag and drop files here</strong></p>
                                    <p class="upload-text">or <button class="upload-link">browse files</button></p>
                                    <p class="upload-info">Supported formats: PDF, TXT, DOCX, MD, XLSX (Max 10MB each)
                                    </p>
                                </div>
                            </div>

                            <!-- Document List -->
                            <div id="company-docs-container" class="document-list">
                                <p class="no-docs">No documents uploaded yet</p>
                            </div>
                            <div class="doc-list-actions">
                                <button id="company-clear-files" class="btn btn--outline btn--sm" style="display:none;">
                                    Clear All Files
                                </button>
                            </div>


                            <!-- Build Section -->
                            <div class="build-section">
                                <button class="btn btn--primary btn--full-width build-btn" id="company-build-btn"
                                    disabled>
                                    üèóÔ∏è Build & Save Knowledge Base
                                </button>
                                <p id="company-build-hint" class="build-hint">Select a model above to enable building
                                </p>
                            </div>

                            <!-- Status Display -->
                            <div class="status-display">
                                <div class="status-item">
                                    <span class="status-label">Knowledge Base Status:</span>
                                    <span class="status-value" id="company-kb-status">No model selected</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Vector Count:</span>
                                    <span class="status-value" id="company-vector-count">0</span>
                                </div>
                                <div class="status-item saved-path-item" id="company-save-path-item"
                                    style="display: none;">
                                    <span class="status-label">Saved Path:</span>
                                    <span class="status-value saved-path" id="company-save-path"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Assessment Tab -->
            <div id="document-assessment" class="tab-content">
                <div class="content-header">
                    <h1>Document Assessment</h1>
                    <p class="content-description">Upload documents to generate comprehensive audit reports</p>
                </div>

                <div class="assessment-container">
                    <!-- Assessment Main Section -->
                    <div class="assessment-main-section">
                        <!-- Document Assessment Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <div class="card-title-section">
                                    <h3 class="card-title">Document Assessment</h3>
                                    <p class="assessment-status" id="assessment-count">No documents selected</p>
                                </div>
                                <div class="card-status">
                                    <span class="status" id="assessment-status">üìã Ready</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-description">Upload one or more documents to perform comprehensive
                                    assessment and generate detailed audit reports</p>

                                <!-- Upload Area -->
                                <div class="upload-area assessment-upload" id="assessment-upload-area">
                                    <div class="upload-content">
                                        <div class="upload-icon">üìä</div>
                                        <p class="upload-text"><strong>Drag and drop files here</strong></p>
                                        <p class="upload-text">or <button class="upload-link">browse files</button></p>
                                        <p class="upload-info">Supported formats: PDF, TXT, DOCX, MD, XLSX (Max 25MB
                                            each)</p>
                                    </div>
                                </div>

                                <!-- Assessment File Display -->
                                <!-- Assessment File Display -->
                                <div id="assessment-file-display" class="assessment-file-display" style="display:none;">
                                    <div id="assessment-files-list" class="document-list">
                                        <p class="no-docs">No documents selected</p>
                                    </div>
                                    <div class="doc-list-actions">
                                        <button id="assessment-remove-file" class="btn btn--outline btn--sm"
                                            style="display:none;">
                                            Clear All Files
                                        </button>
                                    </div>
                                </div>


                                <!-- Assessment Action -->
                                <div class="build-section">
                                    <button class="btn btn--primary btn--full-width build-btn" id="run-assessment-btn"
                                        disabled>
                                        üìä Run Assessment
                                    </button>
                                    <p id="assessment-build-hint" class="build-hint">Upload files to enable assessment
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Sidebar -->
                    <div class="assessment-sidebar">
                        <!-- Assessment Status Card -->
                        <div class="assessment-card">
                            <div class="card-header">
                                <h4>Assessment Status</h4>
                            </div>
                            <div class="card-body">
                                <div class="status-display">
                                    <div class="status-item">
                                        <span class="status-label">Processing Status:</span>
                                        <span class="status-value" id="assessment-processing-status">Ready</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Report Status:</span>
                                        <span class="status-value" id="report-status">Not generated</span>
                                    </div>
                                    <div class="status-item" id="report-download-item" style="display: none;">
                                        <button id="download-report-btn"
                                            class="btn btn--primary btn--sm btn--full-width">
                                            üì• Download Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Assessment Results Summary -->
                        <div id="assessment-results-summary" class="assessment-card" style="display: none;">
                            <div class="card-header">
                                <h4>Assessment Results</h4>
                            </div>
                            <div class="card-body">
                                <div id="assessment-summary-content">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Chat Tab -->
            <div id="document-chat" class="tab-content">
                <div class="content-header">
                    <h1>Chat with Documents</h1>
                    <p class="content-description">Ask questions grounded in your Global & Company knowledge bases.</p>
                </div>

                <div class="chat-root">
                    <div class="chat-header">
                        <div class="chat-partner">
                            <div class="chat-partner-avatar">ü§ñ</div>
                            <div class="chat-partner-meta">
                                <div class="chat-partner-name">Assistant</div>
                                <div class="chat-partner-status"><span class="status-dot online"></span> Available</div>
                            </div>
                        </div>
                        <div class="chat-header-right">
                            <div class="chat-model-pill">
                                <span>Model:</span>
                                <strong id="chat-active-model">‚Äî</strong>
                            </div>
                            <div class="chat-actions">
                                <button id="chat-clear" class="btn btn--outline btn--sm" title="Clear conversation">üßπ
                                    Clear</button>
                            </div>
                        </div>
                    </div>

                    <div id="chat-messages" class="chat-messages" aria-live="polite">
                        <!-- messages will appear here -->
                        <div class="chat-empty">
                            <div class="placeholder-icon">üí¨</div>
                            <h3>Start chatting with your documents</h3>
                            <p>Type a question below. The assistant will use your saved vectorstores if available.</p>
                        </div>
                    </div>

                    <form id="chat-form" class="chat-input-row" autocomplete="off">
                        <button type="button" class="chat-action chat-attach" title="Attach">üìé</button>
                        <textarea id="chat-input" class="chat-input"
                            placeholder="Write a message‚Ä¶ (Shift+Enter for new line)"></textarea>
                        <div class="chat-send-group">
                            <button type="button" class="chat-action chat-emoji" title="Emoji">üòä</button>
                            <button id="chat-send" class="btn btn--primary chat-send" type="submit" aria-label="Send">
                                <span class="send-label">Send</span>
                                <span class="send-spinner" hidden>Thinking‚Ä¶</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>


    </div>
    </main>
    </div>

    <!-- Hidden File Inputs -->
    <input type="file" id="general-file-input" accept=".pdf,.txt,.docx,.md" multiple style="display: none;">
    <input type="file" id="company-file-input" accept=".pdf,.txt,.docx,.md,.xlsx" multiple style="display: none;">
    <input type="file" id="assessment-file-input" accept=".pdf,.txt,.docx,.md,.xlsx" multiple style="display: none;">

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Deletion</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this document? This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button id="cancel-delete" class="btn btn--outline">Cancel</button>
                <button id="confirm-delete" class="btn btn--primary">Delete</button>
            </div>
        </div>
    </div>

    <!-- Debug console removed -->

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="app.js"></script>
    <script src="chat.js"></script>
</body>

</html>
